#!/bin/sh

# R simply compiles & links everything under src/. We only want to compile files
# generated by the correct thrift version, so copy these files from the thrift/
# dir for the currently installed version.

THRIFT_VERSION=$(pkg-config --modversion thrift)
DEFAULT_VERSION=0.9.3

if [ -z "$THRIFT_VERSION" ]; then
  echo "error: cannot detect thrift version" >&2
  exit 1
elif [ ! -e thrift/"$THRIFT_VERSION" ]; then
  echo "warning: Bee has not been tested with Thrift $THRIFT_VERSION" >&2
  echo "warning: Trying to compile for version $DEFAULT_VERSION." >&2
  echo "warning: Best of luck!"
  THRIFT_VERSION="$DEFAULT_VERSION"
fi

rm -rf inst/include/tcli_thrift
mkdir -p inst/include/tcli_thrift
cp -r thrift/"$THRIFT_VERSION"/gen-cpp/*.h inst/include/tcli_thrift/

rm -rf src/tcli_thrift
mkdir -p src/tcli_thrift
cp -r thrift/"$THRIFT_VERSION"/gen-cpp/*.cpp src/tcli_thrift/
